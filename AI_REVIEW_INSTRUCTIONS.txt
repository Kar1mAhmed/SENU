================================================================================
COPY THIS ENTIRE PROMPT TO YOUR AI ASSISTANT
================================================================================

You are reviewing a Next.js + TypeScript codebase that serves media files from Cloudflare R2 storage. The project has been migrated from Worker proxy serving to direct CDN access.

CRITICAL CONTEXT:
- CDN Domain: https://media.senu.studio
- Environment Variable: NEXT_PUBLIC_R2_DOMAIN (set in wrangler.jsonc)
- Core Function: keyToUrl() in /src/lib/media.ts
- Database stores KEYS (e.g., "slides/video.mp4"), NOT URLs
- Frontend receives URLS (e.g., "https://media.senu.studio/slides/video.mp4")

YOUR TASK:
Perform a comprehensive code review to ensure ALL media serving points use direct CDN access through the keyToUrl() function. No hardcoded /api/media/ paths should exist in components.

REVIEW CHECKLIST:

1. CORE UTILITY (/src/lib/media.ts)
   □ keyToUrl() checks process.env.NEXT_PUBLIC_R2_DOMAIN
   □ Returns CDN URL when env var is set
   □ Falls back to /api/media/ for local dev
   □ Handles null/undefined gracefully

2. DATA TRANSFORMATION (/src/lib/data-transform.ts)
   □ transformProjectForFrontend() uses keyToUrl() for all keys
   □ thumbnailKey → thumbnailUrl conversion
   □ clientLogoKey → clientLogo conversion
   □ mediaKey → videoUrl conversion
   □ No hardcoded /api/media/ strings

3. VIDEO COMPONENTS
   Files: /src/components/main/VideoPlayer/index.tsx
          /src/components/portfolio/ProjectSlides/HorizontalSlides.tsx
          /src/components/portfolio/ProjectSlides/VerticalSlides.tsx
   
   □ All videoUrl props use keyToUrl(slide.mediaKey)
   □ Poster images use keyToUrl() if applicable
   □ No direct key usage without transformation

4. IMAGE COMPONENTS
   Files: /src/components/portfolio/ProjectSlides/ImageSlides.tsx
          /src/components/main/ProjectCard/index.tsx
          /src/components/main/ProjectHero/index.tsx
   
   □ All Image src attributes use keyToUrl()
   □ Preloading logic uses keyToUrl()
   □ No hardcoded media paths

5. PROJECT PAGES
   Files: /src/app/portfolio/page.tsx
          /src/app/portfolio/[projectName]/page.tsx
          /src/components/landing/ProjectHighlight/index.tsx
   
   □ Use transformed data (thumbnailUrl, clientLogo, videoUrl)
   □ No direct database key usage
   □ All media comes from transformed project objects

6. ENVIRONMENT CONFIG (/wrangler.jsonc)
   □ NEXT_PUBLIC_R2_DOMAIN = "https://media.senu.studio"
   □ Variable in vars section
   □ No typos

7. UPLOAD LOGIC
   Files: /src/app/api/projects/route.ts
          /src/app/api/slides/route.ts
   
   □ Stores KEYS in database (not URLs)
   □ uploadMedia() returns keys
   □ No URL storage

8. DATABASE SCHEMA (/migrations/*.sql)
   □ Uses _key columns (thumbnail_key, media_key, etc.)
   □ NOT _url columns

9. TYPE DEFINITIONS (/src/lib/types.ts)
   □ DB types use *Key fields
   □ Frontend types use *Url fields
   □ Clear separation

SEARCH PATTERNS TO USE:

Find hardcoded API paths:
  grep -r "/api/media/" src/
  grep -r '"api/media' src/

Find direct R2 URLs:
  grep -r "r2.dev" src/
  grep -r "r2.cloudflarestorage.com" src/

Find untransformed key usage:
  grep -r "\.mediaKey" src/ | grep -v "keyToUrl"
  grep -r "\.thumbnailKey" src/ | grep -v "keyToUrl"
  grep -r "\.clientLogoKey" src/ | grep -v "keyToUrl"

ANTI-PATTERNS (FAIL):
❌ src="/api/media/slides/video.mp4"
❌ src="https://pub-xxx.r2.dev/slides/video.mp4"
❌ src={slide.mediaKey}
❌ thumbnailUrl: "https://media.senu.studio/..." (in database)

CORRECT PATTERNS (PASS):
✅ src={keyToUrl(slide.mediaKey) || ''}
✅ videoUrl={keyToUrl(slide.mediaKey) || ''}
✅ thumbnailUrl: keyToUrl(dbProject.thumbnailKey)
✅ Database stores: "slides/123-abc-video.mp4" (key only)

OUTPUT FORMAT:

# R2 CDN Direct Access Code Review

## Executive Summary
- Files Reviewed: [number]
- Issues Found: [number]
- Compliance: [percentage]%
- Status: [PASS/FAIL]

## Critical Issues (if any)
[List any blocking issues]

## Detailed Findings

### File: /src/path/to/file.tsx
Status: ✅ PASS / ⚠️ WARNING / ❌ FAIL
- [Finding 1]
- [Finding 2]

[Repeat for each file]

## Issues Requiring Fixes

### Issue #1
- **File:** /src/path/to/file.tsx
- **Line:** 42
- **Severity:** High/Medium/Low
- **Problem:** [Description]
- **Current Code:**
  ```typescript
  [code snippet]
  ```
- **Recommended Fix:**
  ```typescript
  [fixed code]
  ```

[Repeat for each issue]

## Recommendations
1. [Recommendation 1]
2. [Recommendation 2]

## Conclusion
[Overall assessment]

START YOUR REVIEW NOW.

Read the full prompt details in CODE_REVIEW_PROMPT.md for comprehensive instructions.

================================================================================
